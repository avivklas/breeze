version: '3.8'

services:
  breeze1:
    build: .
    ports:
      - "8081:8080"
    volumes:
      - breeze1-data:/root/data
    command: start --path /root/data --port 8080 --internal-port 9090 --public-addr breeze1:8080 --node-id node1 --peers node1=breeze1:9090,node2=breeze2:9090,node3=breeze3:9090 --shards 6
    networks:
      - breeze-net

  breeze2:
    build: .
    ports:
      - "8082:8080"
    volumes:
      - breeze2-data:/root/data
    command: start --path /root/data --port 8080 --internal-port 9090 --public-addr breeze2:8080 --node-id node2 --peers node1=breeze1:9090,node2=breeze2:9090,node3=breeze3:9090 --shards 6
    networks:
      - breeze-net

  breeze3:
    build: .
    ports:
      - "8083:8080"
    volumes:
      - breeze3-data:/root/data
    command: start --path /root/data --port 8080 --internal-port 9090 --public-addr breeze3:8080 --node-id node3 --peers node1=breeze1:9090,node2=breeze2:9090,node3=breeze3:9090 --shards 6
    networks:
      - breeze-net

  kibana:
    image: docker.elastic.co/kibana/kibana:8.10.2
    ports:
      - "5601:5601"
    environment:
      - ELASTICSEARCH_HOSTS=http://breeze1:8080
    networks:
      - breeze-net
    depends_on:
      - breeze1

networks:
  breeze-net:

volumes:
  breeze1-data:
  breeze2-data:
  breeze3-data:
